# Audio Room Backend Mock

Заглушка WebSocket сервера для аудио-комнаты.

## Установка и запуск

1. Установите зависимости:
```bash
go mod download
```

2. Запустите сервер:
```bash
go run main.go
```

Сервер будет доступен на `ws://localhost:8080/audio`

## Протокол

### Подключение

При подключении клиент отправляет JSON сообщение:
```json
{
  "type": "metadata",
  "data": {
    "action": "join",
    "userId": "unique-user-id",
    "userName": "User Name"
  }
}
```

### Получение списка участников

Сервер автоматически отправляет список участников при изменениях:
```json
{
  "type": "metadata",
  "data": {
    "participants": [
      {
        "id": "user-id",
        "name": "User Name",
        "isMuted": false,
        "isSpeaking": false,
        "volume": 1.0
      }
    ]
  }
}
```

### Обновление статуса микрофона

Клиент отправляет:
```json
{
  "type": "participant_update",
  "data": {
    "userId": "user-id",
    "isMuted": true
  }
}
```

### Аудио данные

Аудио отправляется как бинарные сообщения (WebSocket Binary Frame):
- Первые 36 байт: ID участника (UUID в строковом формате)
- Остальные байты: аудио данные в формате WebM/Opus

Сервер пересылает аудио всем участникам кроме отправителя.

## Особенности реализации

- Сервер не выполняет микширование аудио
- MCU архитектура: сервер только пересылает потоки
- Микширование происходит на стороне клиента (в браузере)
- Поддержка регулировки громкости каждого участника
- Автоматическое удаление участников при отключении

## Тестирование

### Тестовый HTML клиент

Откройте `test_client.html` в браузере для быстрого тестирования:

```bash
# В Linux/Mac
open test_client.html

# Или просто откройте файл в браузере
```

Тестовый клиент позволяет:
- Подключаться к серверу
- Включать/выключать микрофон
- Видеть список участников
- Просматривать лог событий

### Тестирование с несколькими клиентами

1. Запустите сервер
2. Откройте `test_client.html` в нескольких вкладках браузера
3. Подключитесь с разными именами
4. Включите микрофон в одной вкладке
5. Проверьте, что аудио приходит в другие вкладки

## Документация API

Подробная документация протокола доступна в файле `API.md`
