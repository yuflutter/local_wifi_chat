# –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ-–∫–æ–º–Ω–∞—Ç—ã

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Frontend (Flutter Web)

#### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `Participant` - –º–æ–¥–µ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –ø–æ–ª—è–º–∏: id, name, isMuted, isSpeaking, volume
- ‚úÖ `WsMessage` - –º–æ–¥–µ–ª—å WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ç–∏–ø–∞–º–∏: metadata, audioChunk, participantUpdate, error

#### 2. –°–µ—Ä–≤–∏—Å—ã
- ‚úÖ `AudioRoomService` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
  - –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ-—á–∞–Ω–∫–æ–≤
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  
- ‚úÖ `AudioPlayerService` - –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ
  - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  - –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏
  
- ‚úÖ `AudioRecorderService` - –∑–∞–ø–∏—Å—å —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
  - MediaRecorder API
  - –§–æ—Ä–º–∞—Ç WebM/Opus
  - –ß–∞–Ω–∫–∏ –ø–æ 100ms
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

#### 3. Provider
- ‚úÖ `AudioRoomProvider` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

#### 4. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ `AudioPage` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  - –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º
  
- ‚úÖ `ConnectionDialog` - –¥–∏–∞–ª–æ–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –í–≤–æ–¥ URL —Å–µ—Ä–≤–µ—Ä–∞
  - –í–≤–æ–¥ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID
  
- ‚úÖ `ParticipantTile` - –∫–∞—Ä—Ç–æ—á–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  - –ê–≤–∞—Ç–∞—Ä
  - –ò–º—è –∏ —Å—Ç–∞—Ç—É—Å
  - –°–ª–∞–π–¥–µ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏
  - –ö–Ω–æ–ø–∫–∞ mute

### Backend Mock (Go)

- ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8080
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–æ–π –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- ‚úÖ –ü–µ—Ä–µ—Å—ã–ª–∫–∞ –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–æ–≤ (MCU –±–µ–∑ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π/–æ—Ç–∫–ª—é—á–µ–Ω–∏–π

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ `AUDIO_ROOM_README.md` - –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- ‚úÖ `AUDIO_ROOM_SETUP.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- ‚úÖ `INTEGRATION_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `backend_mock/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–µ–∫–µ–Ω–¥–∞
- ‚úÖ `backend_mock/API.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- ‚úÖ `start_audio_room.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ `backend_mock/test_client.html` - HTML —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç

## üìã –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
```
–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä: WebSocket connect
–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä: { type: "metadata", action: "join", userId, userName }
–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç: { type: "metadata", participants: [...] }
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```
–£—á–∞—Å—Ç–Ω–∏–∫ A ‚Üí –°–µ—Ä–≤–µ—Ä: [Binary: userId + audioData]
–°–µ—Ä–≤–µ—Ä ‚Üí –£—á–∞—Å—Ç–Ω–∏–∫–∏ B,C,D: [Binary: userId + audioData]
–ë—Ä–∞—É–∑–µ—Ä: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏
```

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ
```
–ë—Ä–∞—É–∑–µ—Ä: MediaRecorder ‚Üí audioChunks (100ms)
–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä: [Binary: userId + audioData]
–°–µ—Ä–≤–µ—Ä ‚Üí –î—Ä—É–≥–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏: [Binary: userId + audioData]
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
```
–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä: { type: "participant_update", userId, isMuted }
–°–µ—Ä–≤–µ—Ä ‚Üí –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã: { type: "metadata", participants: [...] }
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### MCU –±–µ–∑ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –ø–æ—Ç–æ–∫–∏
- –ú–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏

### –ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –ß–∞–Ω–∫–∏ –ø–æ 100ms
- –ü—Ä—è–º–∞—è –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- WebSocket –¥–ª—è real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### –ì–∏–±–∫–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å mute –ª—é–±–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
- –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –æ—Ç 0% –¥–æ 100%

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Frontend
- Flutter Web 3.10.3+
- web_socket_channel 3.0.1
- record 5.1.2
- provider 6.1.5
- Web Audio API (—á–µ—Ä–µ–∑ dart:html)
- MediaRecorder API

### Backend
- Go 1.21+
- gorilla/websocket 1.5.1

## üìä –ü—Ä–æ—Ç–æ–∫–æ–ª

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (JSON)
- `metadata` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö
- `participant_update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- `error` - –æ—à–∏–±–∫–∏

### –ë–∏–Ω–∞—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –§–æ—Ä–º–∞—Ç: `[36 –±–∞–π—Ç userId][N –±–∞–π—Ç audioData]`
- –ö–æ–¥–µ–∫: Opus
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: WebM

## üöÄ –ó–∞–ø—É—Å–∫

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
```bash
./start_audio_room.sh
```

### –†—É—á–Ω–æ–π
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Backend
cd backend_mock && go run main.go

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Frontend
flutter run -d chrome --web-browser-flag "--disable-web-security"
```

## üìù –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (18 —Ñ–∞–π–ª–æ–≤)

**Frontend (11 —Ñ–∞–π–ª–æ–≤):**
1. `lib/features/voice_room/models/participant.dart`
2. `lib/features/voice_room/models/ws_message.dart`
3. `lib/features/voice_room/services/audio_room_service.dart`
4. `lib/features/voice_room/services/audio_player_service.dart`
5. `lib/features/voice_room/services/audio_recorder_service.dart`
6. `lib/features/voice_room/providers/audio_room_provider.dart`
7. `lib/features/voice_room/widgets/connection_dialog.dart`
8. `lib/features/voice_room/widgets/participant_tile.dart`
9. `lib/features/voice_room/view/audio_page.dart` (–æ–±–Ω–æ–≤–ª–µ–Ω)

**Backend (5 —Ñ–∞–π–ª–æ–≤):**
10. `backend_mock/main.go`
11. `backend_mock/go.mod`
12. `backend_mock/README.md`
13. `backend_mock/API.md`
14. `backend_mock/test_client.html`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (4 —Ñ–∞–π–ª–∞):**
15. `AUDIO_ROOM_README.md`
16. `AUDIO_ROOM_SETUP.md`
17. `INTEGRATION_GUIDE.md`
18. `start_audio_room.sh`

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (2 —Ñ–∞–π–ª–∞):**
- `pubspec.yaml` (–¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- `lib/main.dart` (–¥–æ–±–∞–≤–ª–µ–Ω Provider)

## ‚ú® –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

1. ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
2. ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
3. ‚úÖ Provider –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
4. ‚úÖ UI –≥–æ—Ç–æ–≤
5. ‚úÖ Backend –∑–∞–≥–ª—É—à–∫–∞ –≥–æ—Ç–æ–≤–∞
6. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
7. ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
8. ‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≥–æ—Ç–æ–≤

## üéâ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `./start_audio_room.sh`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫ –±—Ä–∞—É–∑–µ—Ä–∞
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞—É–¥–∏–æ-—Å–≤—è–∑—å
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: `AUDIO_ROOM_README.md`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞: `AUDIO_ROOM_SETUP.md`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: `INTEGRATION_GUIDE.md`
- API: `backend_mock/API.md`
